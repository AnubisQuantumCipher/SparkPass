#!/usr/bin/expect -f
set timeout 60
set vault_path "test_vault.spass"
set password "test_password_12345"

spawn ./bin/sparkpass_main device enroll $vault_path

expect "Touch ID prompt will appear..."
puts "\n==> Please authenticate with Touch ID when prompted\n"

expect "Touch ID verified"
puts "\n==> Touch ID verified\n"

expect {
    "Enter vault passphrase" {
        send "$password\r"
    }
    "Password:" {
        send "$password\r"
    }
}

expect {
    "Touch ID enrolled successfully!" {
        puts "\n==> SUCCESS: Touch ID enrolled\n"
        exit 0
    }
    "Error:" {
        puts "\n==> FAILED\n"
        exit 1
    }
    eof {
        puts "\n==> Process ended\n"
    }
}

expect eof
